/*!
 * C-Like Data Structure for JavaScript.
 *
 * @author Joon Kyoung (aka. Firejune)
 * @license MIT
 * @version 0.2.1
 *
 */

(function(x,q){function n(a){return!!a&&a.constructor===Array}function m(a){return!!a&&a.constructor===String}function u(a,e){for(var b in e)a.hasOwnProperty(b)&&(m(a[b])&&(a[b]=[a[b],0]),a[b]&&a[b].constructor===Object?a[b]=u(a[b],e[b]):a[b][1]=e[b]);return a}function s(a,e){for(var b in a)if(a.hasOwnProperty(b)){var d=a[b];if(d&&d.constructor===Object)s(d,e);else{var k=m(d)?q:d[1];e(d,{value:k,typed:(n(d)&&d[0]||d).toLowerCase(),bytes:n(d)&&3==d.length&&d[2]||(m(k)||n(k))&&k.length||1})}}}function v(a,
e,b){var d={},k=b.endian,q=b.defaultValue,g;for(g in a)if(a.hasOwnProperty(g)){var c=a[g];if(c&&c.constructor===Object)d[g]=v(c,e,b);else{for(var l=[],p=(n(c)&&c[0]||c).toLowerCase(),f=m(c)?q:c[1],c=n(c)&&3==c.length&&c[2]||(m(f)||n(f))&&f.length||1,h=0;h<c;h++)l[h]=e["get"+(p.charAt(0).toUpperCase()+p.slice(1))](b.offset,k),b.offset+=t[p];if(m(f)||n(f)||1<c){p=d;c=g;if(m(f)){f=[];for(h=0;h<l.length;h++)f[h]=String.fromCharCode(l[h]);l=f.join("")}p[c]=l}else d[g]=l[0]}}return d}function y(a){var e=
0;s(a,function(a,d){e+=t[d.typed]*d.bytes});return e}var t={int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},w=function(a,e,b){this.struct=a;this.defaultValue=e||0;this.byteLength=y(a);this.emptyBuffer=new ArrayBuffer(this.byteLength);this.endian=b==q&&!0||b};w.prototype={read:function(a,e){var b;b=a instanceof DataView?a:new DataView(a);this.offset=e||0;return v(this.struct,b,this)},write:function(a){var e=new DataView(this.emptyBuffer),b=this.defaultValue,d=this.endian,k=0;
a!=q&&(this.struct=u(this.struct,a));s(this.struct,function(a,g){var c=g.value===q?b:g.value,l=g.typed,p=g.bytes;if(m(c)||n(c)||1<p){var f;if(f=m(c)){f=c;for(var h=[],r=0;r<f.length;r++)h[r]=f.charCodeAt(r);f=h}c=f||c}else c=[c];for(f=0;f<p;f++)e["set"+(l.charAt(0).toUpperCase()+l.slice(1))](k,c[f],d),k+=t[l]});return e.buffer}};x.Struct=w})(window);